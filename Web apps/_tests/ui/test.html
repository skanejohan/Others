<!DOCTYPE html>
<html>
    <style>
        html, body {
            width:  100%;
            height: 100%;
            margin: 0px;
            background-color: ecd9c6;
        }
    </style>
    
<head>
    <title>Test</title>
    <script src="..\..\_include\timing\timer.js"></script>
    <script src="..\..\_include\timing\timedvaluemodifier.js"></script>
    <script src="..\..\_include\drawing\scaling_canvas.js"></script>
    <script src="..\..\_include\drawing\text_utils.js"></script>
    <script src="..\..\_include\drawing\ui\animations.js"></script>
    <script src="..\..\_include\drawing\ui\elements.js"></script>
    <script src="..\..\_include\drawing\ui\engine.js"></script>

    <script>
        var engine;
        var sizedCanvas;

        function draw(timestamp) {
            window.requestAnimationFrame(draw);
            sizedCanvas.setDimensions(window.innerWidth, window.innerHeight);
            engine.draw();
        }

        function randomElement(x, y, fn) {
            switch(Math.floor(Math.random() * 5)) {
                case 0: return { element : new FillRect(350, 175, 100, 100, "blue", fn) };
                case 1: return { element : new FillRect(x, y, 100, 100, "red", fn), layer : 0 };
                case 2: return { element : new Rect(x, y, 100, 100, "black", fn), layer : 1 };
                case 3: return { element : new RoundRect(x, y, 100, 100, 15, "green", fn), layer : 1 };
                case 4: return { element : new FillRoundRect(x, y, 100, 100, 15, "yellow", fn), layer : 0 };
            }
        }

        function init() {
            let w = 800;
            let h = 450;
            let modal = false;
            sizedCanvas = new ScalingCanvas(document.getElementById("canvas"), w, h);
            engine = new Engine(sizedCanvas);

            engine.onclick = function(x, y, elem) {
                if (modal == false) {
                    var e = randomElement(0, y, () => {
                        e.element.finishAfterAnimations = true; 
                        e.element.popup.fadeOut(200);
                        e.element.fadeOut(200, () => modal = false); });
                    e.element.popup = new Rect(0, 0, 100, 100, "red");
                    e.element.fadeIn(200);
                    if (e.layer === undefined) {
                        e.element.x = x;
                        engine.addModal(e.element);
                        modal = true;
                    }
                    else {
                        e.element.translateX(x, 2000);
                        engine.add(e.element, e.layer);
                    }
                }
            }

            engine.add(new Rect(250, 100, 300, 100, "green"));
            var title = new Text(250, 100, 300, 100, "M elements test M", "24px arial", "red", HorizontalAlignment.JUSTIFY, VerticalAlignment.MIDDLE);
            engine.add(title);
            fadeTitle();

            window.requestAnimationFrame(draw);

            function fadeTitle() {
                title.fadeIn(200, () => title.fadeOut(200, fadeTitle));
            }
        }
</script>
</head>

<body onload="init();">
    <canvas id="canvas" />
</body>

</html>
